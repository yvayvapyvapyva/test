<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞–≤–∏–≥–∞—Ç–æ—Ä —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≥–æ–ª–æ—Å–æ–≤—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏</title>
    <style>
        /* ... (—Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ) ... */
        .voice-instructions {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
        .platform-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        .platform-tab {
            padding: 8px 15px;
            background-color: #f0f0f0;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        .platform-tab.active {
            background-color: #2196F3;
            color: white;
        }
        .platform-content {
            display: none;
            padding: 10px;
            background-color: white;
            border-radius: 4px;
        }
        .platform-content.active {
            display: block;
        }
        .voice-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .stat-item {
            padding: 10px;
            background-color: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ù–∞–≤–∏–≥–∞—Ç–æ—Ä —Å –≥–æ–ª–æ—Å–æ–≤—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏</h1>
        
        <div class="voice-instructions">
            <h3>üì¢ –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –≥–æ–ª–æ—Å–æ–≤:</h3>
            <div class="platform-tabs">
                <button class="platform-tab active" data-platform="windows">Windows</button>
                <button class="platform-tab" data-platform="mac">macOS</button>
                <button class="platform-tab" data-platform="linux">Linux</button>
                <button class="platform-tab" data-platform="browser">–ë—Ä–∞—É–∑–µ—Ä—ã</button>
            </div>
            
            <div id="windows" class="platform-content active">
                <h4>Windows 10/11:</h4>
                <ol>
                    <li>–ù–∞–∂–º–∏—Ç–µ <strong>–ü—É—Å–∫ ‚Üí –ü–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí –í—Ä–µ–º—è –∏ —è–∑—ã–∫</strong></li>
                    <li>–í—ã–±–µ—Ä–∏—Ç–µ <strong>–†–µ—á—å</strong> –≤ –ª–µ–≤–æ–º –º–µ–Ω—é</li>
                    <li>–í —Ä–∞–∑–¥–µ–ª–µ "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞–º–∏" –Ω–∞–∂–º–∏—Ç–µ <strong>–î–æ–±–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å–∞</strong></li>
                    <li>–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –†—É—Å—Å–∫–∏–π) –∏ –Ω—É–∂–Ω—ã–µ –≥–æ–ª–æ—Å–∞</li>
                    <li>–ù–∞–∂–º–∏—Ç–µ <strong>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</strong></li>
                </ol>
                <p><strong>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥–æ–ª–æ—Å–∞:</strong></p>
                <ul>
                    <li>Microsoft Irina Desktop (–∂–µ–Ω—Å–∫–∏–π)</li>
                    <li>Microsoft Pavel (–º—É–∂—Å–∫–æ–π)</li>
                    <li>RHVoice (—Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º)</li>
                </ul>
            </div>
            
            <div id="mac" class="platform-content">
                <h4>macOS:</h4>
                <ol>
                    <li>–û—Ç–∫—Ä–æ–π—Ç–µ <strong>–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø</strong></li>
                    <li>–í—ã–±–µ—Ä–∏—Ç–µ <strong>–†–µ—á—å</strong> –≤ –ª–µ–≤–æ–º –º–µ–Ω—é</li>
                    <li>–ù–∞–∂–º–∏—Ç–µ <strong>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...</strong></li>
                    <li>–í—ã–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –≥–æ–ª–æ—Å–∞</li>
                </ol>
            </div>
            
            <div id="linux" class="platform-content">
                <h4>Linux (Ubuntu/Debian):</h4>
                <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px;">
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ RHVoice (—Ä—É—Å—Å–∫–∏–µ –≥–æ–ª–æ—Å–∞)
sudo apt-get install rhvoice rhvoice-russian

# –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ eSpeak
sudo apt-get install espeak espeak-data

# –î–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è:
sudo apt-get install speech-dispatcher</pre>
            </div>
            
            <div id="browser" class="platform-content">
                <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞:</h4>
                <p><strong>Google Chrome:</strong></p>
                <ol>
                    <li>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <strong>chrome://flags/</strong></li>
                    <li>–ù–∞–π–¥–∏—Ç–µ "Experimental Web Platform features"</li>
                    <li>–í–∫–ª—é—á–∏—Ç–µ —ç—Ç—É –æ–ø—Ü–∏—é</li>
                    <li>–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä</li>
                </ol>
                <p><strong>Firefox:</strong> –ì–æ–ª–æ—Å–∞ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å–∏—Å—Ç–µ–º—ã</p>
                <p><strong>Edge:</strong> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–æ–ª–æ—Å–∞ Windows</p>
            </div>
        </div>
        
        <div class="voice-controls">
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–∞:</h3>
            <div class="voice-test">
                <label for="voiceSelect">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–ª–æ—Å:</label>
                <select id="voiceSelect">
                    <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ–ª–æ—Å–æ–≤...</option>
                </select>
                <button id="refreshVoicesBtn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            
            <div class="voice-stats" id="voiceStats">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–¥–µ—Å—å -->
            </div>
            
            <div class="voice-test">
                <label for="voiceRate">–°–∫–æ—Ä–æ—Å—Ç—å:</label>
                <input type="range" id="voiceRate" min="0.5" max="2" step="0.1" value="1">
                <span id="rateValue">1.0</span>
                
                <label for="voicePitch" style="margin-left: 20px;">–í—ã—Å–æ—Ç–∞:</label>
                <input type="range" id="voicePitch" min="0.5" max="2" step="0.1" value="1">
                <span id="pitchValue">1.0</span>
                
                <label for="voiceVolume" style="margin-left: 20px;">–ì—Ä–æ–º–∫–æ—Å—Ç—å:</label>
                <input type="range" id="voiceVolume" min="0" max="1" step="0.1" value="1">
                <span id="volumeValue">1.0</span>
            </div>
            
            <div class="voice-test">
                <input type="text" id="testText" value="–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ–ª–æ—Å–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫" 
                       style="flex-grow: 1; padding: 8px;">
                <button id="testVoiceBtn">‚ñ∂ –ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏</button>
                <button id="stopVoiceBtn">‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            </div>
            
            <div class="voice-preview" id="voiceInfo">
                –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ–ª–æ—Å–µ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
            </div>
        </div>
        
        <!-- –û—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
        <div>
            <h3>–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞:</h3>
            <textarea id="pointsInput">55.7520,37.6175,–ò–¥–∏—Ç–µ –∫ –°–ø–∞—Å—Å–∫–æ–π –±–∞—à–Ω–µ
55.7530,37.6190,–ü–æ–≤–µ—Ä–Ω–∏—Ç–µ –Ω–∞–ª–µ–≤–æ –∫ —Å–æ–±–æ—Ä—É
55.7540,37.6200,–ü–æ–¥–æ–π–¥–∏—Ç–µ –∫ –¶–∞—Ä—å-–ø—É—à–∫–µ
55.7550,37.6210,–í—ã —É —Ü–µ–ª–∏ - –£—Å–ø–µ–Ω—Å–∫–∏–π —Å–æ–±–æ—Ä</textarea>
        </div>
        
        <div class="controls">
            <button id="startBtn">‚ñ∂ –ù–∞—á–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é</button>
            <button id="stopBtn" disabled>‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            <button id="getLocationBtn">üìç –ü–æ–ª—É—á–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
        </div>
        
        <div class="status" id="status">
            –°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        </div>
        
        <div id="pointsList"></div>
    </div>

    <script>
        let watchId = null;
        let points = [];
        let currentPointIndex = 0;
        let isNavigating = false;
        let speechSynthesis = window.speechSynthesis;
        let voices = [];
        let selectedVoice = null;
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–∞
        let voiceSettings = {
            rate: 1.0,
            pitch: 1.0,
            volume: 1.0
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const elements = {
            pointsInput: document.getElementById('pointsInput'),
            startBtn: document.getElementById('startBtn'),
            stopBtn: document.getElementById('stopBtn'),
            getLocationBtn: document.getElementById('getLocationBtn'),
            statusDiv: document.getElementById('status'),
            pointsListDiv: document.getElementById('pointsList'),
            voiceSelect: document.getElementById('voiceSelect'),
            testVoiceBtn: document.getElementById('testVoiceBtn'),
            stopVoiceBtn: document.getElementById('stopVoiceBtn'),
            refreshVoicesBtn: document.getElementById('refreshVoicesBtn'),
            testText: document.getElementById('testText'),
            voiceInfo: document.getElementById('voiceInfo'),
            voiceStats: document.getElementById('voiceStats'),
            voiceRate: document.getElementById('voiceRate'),
            voicePitch: document.getElementById('voicePitch'),
            voiceVolume: document.getElementById('voiceVolume'),
            rateValue: document.getElementById('rateValue'),
            pitchValue: document.getElementById('pitchValue'),
            volumeValue: document.getElementById('volumeValue')
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            initPlatformTabs();
            initVoiceControls();
            loadVoices();
            parsePoints();
            updatePointsList();
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–æ–≤—ã—Ö –≥–æ–ª–æ—Å–æ–≤
            setInterval(loadVoices, 30000);
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º
        function initPlatformTabs() {
            const tabs = document.querySelectorAll('.platform-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const platform = tab.dataset.platform;
                    
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                    document.querySelectorAll('.platform-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.platform-content').forEach(c => c.classList.remove('active'));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–µ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É
                    tab.classList.add('active');
                    document.getElementById(platform).classList.add('active');
                });
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–º
        function initVoiceControls() {
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏
            elements.voiceRate.addEventListener('input', (e) => {
                voiceSettings.rate = parseFloat(e.target.value);
                elements.rateValue.textContent = voiceSettings.rate.toFixed(1);
            });

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã—Å–æ—Ç—ã —Ç–æ–Ω–∞
            elements.voicePitch.addEventListener('input', (e) => {
                voiceSettings.pitch = parseFloat(e.target.value);
                elements.pitchValue.textContent = voiceSettings.pitch.toFixed(1);
            });

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
            elements.voiceVolume.addEventListener('input', (e) => {
                voiceSettings.volume = parseFloat(e.target.value);
                elements.volumeValue.textContent = voiceSettings.volume.toFixed(1);
            });

            // –¢–µ—Å—Ç –≥–æ–ª–æ—Å–∞
            elements.testVoiceBtn.addEventListener('click', () => {
                speak(elements.testText.value, true);
            });

            // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–æ–ª–æ—Å
            elements.stopVoiceBtn.addEventListener('click', () => {
                speechSynthesis.cancel();
            });

            // –û–±–Ω–æ–≤–∏—Ç—å –≥–æ–ª–æ—Å–∞
            elements.refreshVoicesBtn.addEventListener('click', () => {
                loadVoices();
                showNotification('–ì–æ–ª–æ—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
            });

            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ–ª–æ—Å–∞
            elements.voiceSelect.addEventListener('change', (e) => {
                const voiceName = e.target.value;
                selectedVoice = voices.find(voice => voice.name === voiceName);
                updateVoiceInfo();
                
                if (selectedVoice) {
                    speak('–ì–æ–ª–æ—Å –∏–∑–º–µ–Ω—ë–Ω', true);
                }
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤
        function loadVoices() {
            // –ü–æ–ª—É—á–∞–µ–º –≥–æ–ª–æ—Å–∞
            voices = speechSynthesis.getVoices();
            
            if (voices.length === 0) {
                setTimeout(loadVoices, 100);
                return;
            }
            
            updateVoiceSelect();
            updateVoiceStats();
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ–º –º—É–∂—Å–∫–æ–π –≥–æ–ª–æ—Å, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
            if (!selectedVoice) {
                selectPreferredVoice();
            }
            
            updateVoiceInfo();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –≥–æ–ª–æ—Å–æ–≤
        function updateVoiceSelect() {
            elements.voiceSelect.innerHTML = '';
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –≥–æ–ª–æ—Å–∞ –ø–æ —è–∑—ã–∫—É
            const voicesByLang = {};
            
            voices.forEach(voice => {
                const lang = voice.lang || 'unknown';
                if (!voicesByLang[lang]) {
                    voicesByLang[lang] = [];
                }
                voicesByLang[lang].push(voice);
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —è–∑—ã–∫–∏
            const sortedLangs = Object.keys(voicesByLang).sort();
            
            sortedLangs.forEach(lang => {
                const langVoices = voicesByLang[lang];
                
                // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—É –¥–ª—è —è–∑—ã–∫–∞
                const optgroup = document.createElement('optgroup');
                optgroup.label = `${getLanguageName(lang)} (${langVoices.length})`;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≥–æ–ª–æ—Å–∞ –≤ –≥—Ä—É–ø–ø—É
                langVoices.forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voice.name;
                    option.textContent = `${voice.name}${voice.default ? ' (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)' : ''}`;
                    
                    // –í—ã–¥–µ–ª—è–µ–º –º—É–∂—Å–∫–∏–µ –≥–æ–ª–æ—Å–∞
                    if (isMaleVoice(voice)) {
                        option.style.fontWeight = 'bold';
                        option.textContent = '‚ôÇ ' + option.textContent;
                    }
                    
                    // –í—ã–¥–µ–ª—è–µ–º –∂–µ–Ω—Å–∫–∏–µ –≥–æ–ª–æ—Å–∞
                    if (isFemaleVoice(voice)) {
                        option.textContent = '‚ôÄ ' + option.textContent;
                    }
                    
                    if (selectedVoice && voice.name === selectedVoice.name) {
                        option.selected = true;
                    }
                    
                    optgroup.appendChild(option);
                });
                
                elements.voiceSelect.appendChild(optgroup);
            });
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≥–æ–ª–æ—Å–∞
        function selectPreferredVoice() {
            // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
            // 1. –†—É—Å—Å–∫–∏–µ –º—É–∂—Å–∫–∏–µ –≥–æ–ª–æ—Å–∞
            // 2. –†—É—Å—Å–∫–∏–µ –≥–æ–ª–æ—Å–∞
            // 3. –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –º—É–∂—Å–∫–∏–µ –≥–æ–ª–æ—Å–∞
            // 4. –ì–æ–ª–æ—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            
            const russianMaleVoices = voices.filter(voice => 
                (voice.lang.startsWith('ru') || voice.lang.startsWith('ru-RU')) && 
                isMaleVoice(voice)
            );
            
            const russianVoices = voices.filter(voice => 
                voice.lang.startsWith('ru') || voice.lang.startsWith('ru-RU')
            );
            
            const englishMaleVoices = voices.filter(voice => 
                (voice.lang.startsWith('en') || voice.lang.startsWith('en-')) && 
                isMaleVoice(voice)
            );
            
            if (russianMaleVoices.length > 0) {
                selectedVoice = russianMaleVoices[0];
            } else if (russianVoices.length > 0) {
                selectedVoice = russianVoices[0];
            } else if (englishMaleVoices.length > 0) {
                selectedVoice = englishMaleVoices[0];
            } else {
                // –ò—â–µ–º –≥–æ–ª–æ—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                selectedVoice = voices.find(voice => voice.default) || voices[0];
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ–ª–æ—Å –≤ select
            if (selectedVoice) {
                elements.voiceSelect.value = selectedVoice.name;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º—É–∂—Å–∫–æ–≥–æ –≥–æ–ª–æ—Å–∞
        function isMaleVoice(voice) {
            const name = voice.name.toLowerCase();
            return name.includes('male') || 
                   name.includes('–º—É–∂—Å–∫') ||
                   name.includes('pavel') ||
                   name.includes('dmitri') ||
                   name.includes('maxim') ||
                   name.includes('alex') ||
                   name.includes('mikhail') ||
                   name.includes('male') ||
                   name.includes('Áî∑‰∫∫') ||
                   name.includes('masculine');
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–µ–Ω—Å–∫–æ–≥–æ –≥–æ–ª–æ—Å–∞
        function isFemaleVoice(voice) {
            const name = voice.name.toLowerCase();
            return name.includes('female') || 
                   name.includes('–∂–µ–Ω—Å–∫') ||
                   name.includes('irina') ||
                   name.includes('anna') ||
                   name.includes('natalia') ||
                   name.includes('female') ||
                   name.includes('Â•≥‰∫∫') ||
                   name.includes('feminine');
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —è–∑—ã–∫–∞
        function getLanguageName(langCode) {
            const languages = {
                'ru': '–†—É—Å—Å–∫–∏–π',
                'ru-RU': '–†—É—Å—Å–∫–∏–π (–†–æ—Å—Å–∏—è)',
                'en': '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π',
                'en-US': '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π (–°–®–ê)',
                'en-GB': '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π (–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è)',
                'de': '–ù–µ–º–µ—Ü–∫–∏–π',
                'fr': '–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π',
                'es': '–ò—Å–ø–∞–Ω—Å–∫–∏–π',
                'it': '–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π'
            };
            
            return languages[langCode] || langCode;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≥–æ–ª–æ—Å–æ–≤
        function updateVoiceStats() {
            const total = voices.length;
            const russian = voices.filter(v => v.lang.startsWith('ru')).length;
            const english = voices.filter(v => v.lang.startsWith('en')).length;
            const male = voices.filter(isMaleVoice).length;
            const female = voices.filter(isFemaleVoice).length;
            const defaultVoices = voices.filter(v => v.default).length;
            
            elements.voiceStats.innerHTML = `
                <div class="stat-item">
                    <strong>–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤:</strong> ${total}
                </div>
                <div class="stat-item">
                    <strong>–†—É—Å—Å–∫–∏–µ:</strong> ${russian}
                </div>
                <div class="stat-item">
                    <strong>–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ:</strong> ${english}
                </div>
                <div class="stat-item">
                    <strong>‚ôÇ –ú—É–∂—Å–∫–∏–µ:</strong> ${male}
                </div>
                <div class="stat-item">
                    <strong>‚ôÄ –ñ–µ–Ω—Å–∫–∏–µ:</strong> ${female}
                </div>
                <div class="stat-item">
                    <strong>–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:</strong> ${defaultVoices}
                </div>
            `;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥–æ–ª–æ—Å–µ
        function updateVoiceInfo() {
            if (selectedVoice) {
                const isMale = isMaleVoice(selectedVoice);
                const isFemale = isFemaleVoice(selectedVoice);
                const gender = isMale ? '–ú—É–∂—Å–∫–æ–π' : (isFemale ? '–ñ–µ–Ω—Å–∫–∏–π' : '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω');
                
                elements.voiceInfo.innerHTML = `
                    <strong>–¢–µ–∫—É—â–∏–π –≥–æ–ª–æ—Å:</strong> ${selectedVoice.name}<br>
                    <strong>–Ø–∑—ã–∫:</strong> ${selectedVoice.lang} (${getLanguageName(selectedVoice.lang)})<br>
                    <strong>–ü–æ–ª:</strong> ${gender}<br>
                    <strong>–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:</strong> ${selectedVoice.default ? '–î–∞' : '–ù–µ—Ç'}<br>
                    <strong>–õ–æ–∫–∞–ª—å–Ω—ã–π:</strong> ${selectedVoice.localService ? '–î–∞' : '–ù–µ—Ç'}
                `;
            } else {
                elements.voiceInfo.innerHTML = '–ì–æ–ª–æ—Å –Ω–µ –≤—ã–±—Ä–∞–Ω';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
        function speak(text, isTest = false) {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–æ–ª–æ—Å–∞
            utterance.voice = selectedVoice;
            utterance.lang = selectedVoice ? selectedVoice.lang : 'ru-RU';
            utterance.rate = voiceSettings.rate;
            utterance.pitch = voiceSettings.pitch;
            utterance.volume = voiceSettings.volume;
            
            // –°–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            if (isTest) {
                utterance.onstart = () => console.log('–ù–∞—á–∞–ª–æ —Ä–µ—á–∏:', text);
                utterance.onend = () => console.log('–ö–æ–Ω–µ—Ü —Ä–µ—á–∏');
                utterance.onerror = (event) => console.error('–û—à–∏–±–∫–∞ —Ä–µ—á–∏:', event);
            }
            
            speechSynthesis.speak(utterance);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 15px;
                border-radius: 5px;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–ø–∞—Ä—Å–∏–Ω–≥ —Ç–æ—á–µ–∫, –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ —Ç.–¥.) –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        // ... (–≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞, –Ω–∞—á–∏–Ω–∞—è —Å parsePoints)

    </script>
</body>
</html>
